{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AnalyzeProductResponse",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "jobId": {
      "anyOf": [
        { "type": "number" },
        { "type": "null" }
      ]
    },
    "title": { "type": "string" },
    "description": { "type": "string" },
    "tags": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "value": { "type": "string" },
          "score": { "type": "number" },
          "source": { "type": "string" }
        },
        "required": ["value"]
      }
    },
    "captions": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "imageIndex": { "type": "number" },
          "text": { "type": "string" },
          "source": { "type": "string" }
        },
        "required": ["imageIndex", "text"]
      }
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "contractVersion": { "type": "string" },
        "device": { "type": "string", "enum": ["openvino:GPU", "openvino:NPU"] },
        "models": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "tagger": { "type": "string" },
            "captioner": { "type": "string" },
            "llm": { "type": "string" }
          },
          "required": ["tagger", "captioner", "llm"]
        },
        "timings": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "imageLoadMs": { "type": "number" },
            "taggerMs": { "type": "number" },
            "captionerMs": { "type": "number" },
            "llmMs": { "type": "number" },
            "totalMs": { "type": "number" }
          },
          "required": [
            "imageLoadMs",
            "taggerMs",
            "captionerMs",
            "llmMs",
            "totalMs"
          ]
        }
      },
      "required": ["contractVersion", "device", "models", "timings"]
    },
    "debug": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "clip": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "device": { "type": "string" },
            "modelDir": { "type": "string" },
            "numImages": { "type": "number" },
            "candidatePromptsCount": { "type": "number" },
            "topTags": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "tag": { "type": "string" },
                  "score": { "type": "number" }
                },
                "required": ["tag", "score"]
              }
            },
            "promptExamples": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "required": [
            "device",
            "modelDir",
            "numImages",
            "candidatePromptsCount",
            "topTags"
          ]
        },
        "blip": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "device": { "type": "string" },
            "modelDir": { "type": "string" },
            "expectedHw": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            },
            "captions": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "imageIndex": { "type": "number" },
                  "caption": { "type": "string" }
                },
                "required": ["imageIndex", "caption"]
              }
            }
          },
          "required": ["device", "modelDir", "expectedHw", "captions"]
        },
        "llm": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "device": { "type": "string" },
            "modelDir": { "type": "string" },
            "prompt": { "type": "string" },
            "rawOutput": { "type": "string" },
            "extractedJson": { "type": "string" },
            "parseError": { "type": "string" },
            "schemaError": { "type": "string" }
          },
          "required": ["device", "modelDir", "rawOutput"]
        },
        "timingsMs": {
          "type": "object",
          "additionalProperties": { "type": "number" }
        }
      },
      "required": ["clip", "blip", "llm"]
    }
  },
  "required": ["title", "description", "tags", "captions", "meta"]
}
